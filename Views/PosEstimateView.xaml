<UserControl x:Class="ULTRA.Views.PosEstimateView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:viewmodels="clr-namespace:ULTRA.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1200">

    <UserControl.DataContext>
        <viewmodels:PosEstimateViewModel />
    </UserControl.DataContext>

    <UserControl.Resources>
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="28"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="Btn" TargetType="Button">
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="Background" Value="#F7F7F7"/>
        </Style>

        <Style x:Key="BtnPrimary" TargetType="Button" BasedOn="{StaticResource Btn}">
            <Setter Property="Background" Value="#1E90FF"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderBrush" Value="#1E90FF"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 검색/분류 -->
        <Grid Grid.Row="0" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <TextBox Width="220" Margin="0,0,10,0"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>
                <ComboBox x:Name="CmbMajor" Width="140" Margin="0,0,10,0"
                          ItemsSource="{Binding MajorCategories}"
                          SelectedItem="{Binding SelectedMajorCategory}"/>
                <ComboBox x:Name="CmbMiddle" Width="140"
                          ItemsSource="{Binding MiddleCategories}"
                          SelectedItem="{Binding SelectedMiddleCategory}"/>
            </StackPanel>
        </Grid>

        <!-- 제품 리스트 -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding DisplayedProducts}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="#DDD" BorderThickness="1" Margin="10" Padding="10" Height="340" Width="250">
                            <StackPanel>
                                <Image Source="{Binding 이미지1}" Height="150" Stretch="Uniform"/>
                                <TextBlock Text="{Binding 번호}" FontSize="12" Foreground="Gray"/>
                                <TextBlock Text="{Binding 품명}" FontWeight="Bold" Margin="0,5,0,0" FontSize="16"/>
                                <TextBlock Text="{Binding 제조사}" FontSize="12" Foreground="DarkGray"/>
                                <TextBlock Text="{Binding 공급업체명}" FontSize="12" Foreground="DarkGray"/>
                                <TextBlock Text="{Binding 원산지}" FontSize="12" Foreground="DarkGray"/>
                                <TextBlock Text="{Binding 소매가, StringFormat='₩{0:N0}'}"
                                           Foreground="#1E90FF" FontSize="14" Margin="0,5,0,0"/>
                                <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                    <Button Content="담기" Style="{StaticResource BtnPrimary}" Width="90"
                                            Command="{Binding DataContext.AddToCartCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"/>
                                    <Button Content="상세" Style="{StaticResource Btn}" Width="90" Margin="5,0,0,0"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- 페이지 네비 -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,16,0,0">
            <Button Content="이전" Style="{StaticResource Btn}" Command="{Binding PreviousPageCommand}" Margin="5,0"/>
            <TextBlock Text="{Binding CurrentPage}" Margin="8,0" VerticalAlignment="Center"/>
            <TextBlock Text="/" Margin="4,0" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding TotalPages}" Margin="4,0" VerticalAlignment="Center"/>
            <Button Content="다음" Style="{StaticResource Btn}" Command="{Binding NextPageCommand}" Margin="5,0"/>
        </StackPanel>

        <!-- 장바구니 영역 -->
        <Border Grid.Row="4" BorderBrush="#BBB" BorderThickness="1" Margin="0,16,0,0" Padding="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0">
                    <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                        <TextBlock Text="합계금액: " FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding TotalAmount, StringFormat=₩{0:N0}}" Foreground="#1E90FF"
                                   FontSize="16" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,16,0"/>
                        <Button Content="결제하기" Style="{StaticResource BtnPrimary}" Width="100" Margin="0,0,10,0"
                                Command="{Binding CheckoutCommand}"/>
                        <Button Style="{StaticResource Btn}" Command="{Binding ClearCartCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Image Source="/Assets/delete.png" Width="16" Height="16" Margin="0,0,6,0"/>
                                <TextBlock Text="전체삭제"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </DockPanel>

                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Name="CartScrollViewer">
                    <DataGrid x:Name="CartDataGrid" ItemsSource="{Binding CartItems}" AutoGenerateColumns="False" CanUserAddRows="False"
                              HeadersVisibility="Column" ColumnHeaderHeight="32" RowHeaderWidth="0" Margin="0,10,0,0" FontSize="16">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="코드" Binding="{Binding 번호}" Width="80"/>
                            <DataGridTextColumn Header="품명" Binding="{Binding 품명}" Width="*"/>
                            <DataGridTextColumn Header="옵션" Binding="{Binding 기본옵션}" Width="120"/>
                            <DataGridTemplateColumn Header="수량" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Width="28" Height="28" Background="Transparent" BorderThickness="0"
                                                    Command="{Binding DataContext.DecreaseQuantityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <Image Source="/Assets/remove.png" Width="16" Height="16"/>
                                            </Button>
                                            <TextBlock Text="{Binding 수량}" Width="32" TextAlignment="Center" VerticalAlignment="Center" Margin="4,0"/>
                                            <Button Width="28" Height="28" Background="Transparent" BorderThickness="0"
                                                    Command="{Binding DataContext.IncreaseQuantityCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}">
                                                <Image Source="/Assets/add.png" Width="16" Height="16"/>
                                            </Button>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="단가" Binding="{Binding 소매가, StringFormat=₩{0:N0}}" Width="110"/>
                            <DataGridTextColumn Header="금액" Binding="{Binding 소계, StringFormat=₩{0:N0}}" Width="120"/>
                            <DataGridTemplateColumn Header="" Width="50">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Width="28" Height="28" Background="Transparent" BorderThickness="0"
                                                Command="{Binding DataContext.RemoveFromCartCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}">
                                            <Image Source="/Assets/remove.png" Width="16" Height="16"/>
                                        </Button>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
